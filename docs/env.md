# **Виртуальное окружение**

## Содержание

1. [Зачем виртуальное окружение](#зачем-виртуальное-окружение)
2. [Способы создания виртуального окружения](#способы-создания-виртуального-окружения)
3. [Pipenv](#pipenv)
    - 3.1 [Установка](#установка-pipenv-на-windows)
    - 3.2 [Создание виртуального окружения](#создание-виртуального-окружения)
    - 3.3 [Добавление пакета в pipenv](#добавление-модуля-в-pipenv)
    - 3.4 [Удаление пакета](#удаление-пакета)
    - 3.5 [Pipenv.lock](#pipfilelock)
    - 3.6 [Удаленик виртуального окружения](#удаление-виртуального-окружения)
4. [Ссылки](#ссылки)

## Зачем виртуальное окружение?

Виртуальное окружение необходимо, если у вас множество проектов и под кажный проект необходимы различные пакеты или разные версии одного и того же пакета.

Суть виртуального окружения заключается в следующем:

- создать директорию, где будут храниться все необходимые для проекта зависимости
- создать файл, где будут прописаны все необходимые зависимости

## Способы создания виртуального окружения

- **easy_install** </br>
    *Минусы*: Нет возможности удалить пакет
- **virtualenv** (pip) </br>
    *Минусы*: Ручной процесс (необходимо создать, активировать и т.д.), но можно автоматизировать с помощью утилит
- **pipenv** (pip + virtualenv) </br>
    *Минусы*: Не утилита для пакетирования, не для блиблиотек
- [**poetry**](https://python-poetry.org/) - для разработки библиотек

## Pipenv

Состоит из двух файлов:

- **Pipfile** - описание зависимостей проекта
  - *source* - источник пакетов
  - *packages* - пакеты, которые необходимы для работы проекта (например, numpy)
  - *dev-packages* - пакеты для разработчика, которые не нужны для проекта в дальнейшем (например, тесты)
  - *requeres* - необходимые требования (например, версия Python)
- **Pipfile.lock** - загрузочные хэши (`hashes`)

Pipfile и Pipfile.lock необходимо загрузить вместе с проектом на GitHub.

### Установка pipenv на Windows

```bash
# Установка только для данного пользователя (необходимо будет дополнительно дописать PATH к pipenv)
pip install --user pipenv
```

В Windows дополнительно в `PATH` для данного юзера необходимо прописать `c:\users\%username%\appdata\roaming\programs\python\python310\`

```bash
# Установка для всех пользователей
pip install pipenv
```

Все модули pip в Windows 10 по-умолчанию устанавливаются глобально для всех проектов в:

```/C/Users/%username%/AppData/Local/Programs/Python/Python310/lib/site-packages```

### Создание виртуального окружения

Если необходимо, чтобы установка модулей происходила в директорию с проектом, то в директории с проектом необходимо создать директорию `.venv`, где будут хранится все установленные модели.

При использовании GitHub необходимо добавить директорию `.venv` в `.gitignore`.

Иначе все модули проекта будут хранится в `/C/users/%username%/.virtualenvs/my_project`

```bash
# Переход в директорию с проектом
cd /C/my_project

# Создание виртуального окружения под Python3 (создастся файл Pipfile)
pipenv --three

# Создание виртуального окружения под Python определенной версии
pipenv --python 3.8

# Активация виртуального окружения для данного проекта
pipenv shell

# Выход из окружения
exit
```

### Добавление пакета в виртуальное окружение

Для установки зависимостей для разработчиков (dev-packages) необходимо указать команду `--dev`.
Для зависимостей проекта указывать дополнительно ничего не нужно.

```bash
# Установка последней версии пакета происходит по-умолчанию
pipenv install pytest --dev

# Установка определенной версии пакета
pipenv install flask==0.12.1
```

После добавления пакета в виртуальное окружение, его можно импортировать в коде.

Все модули проекта по-умолчанию будут сохраняться в `C:\Users\%username%\.virtualenvs\<project_directory>\Lib\site-packages`

### Показывает все установленные пакеты в данном проекте

```bash
pipenv graph
```

### Удаление пакета

```bash
# Удаление одного определенного пакета (например, numpy)
pipenv uninstall numpy

# Удаление всех установленных пакетов для данного проекта
pipenv uninstall -all
```

## Pipfile.lock

Файл Pipefile.lock представляет собой файл JSON, в котором указаны некоторые метаданные и точные версии (включая хэши) всех рекурсивных зависимостей (зависимостей верхнего уровня и их зависимостей).

```bash
# Генерация файла Pipfile.lock
pipenv lock

# Установка пакетов из Pipfile.lock
pipenv sync

# Удаление всех пакетов, которых нет в Pipfile.lock (например, оставшиеся зависимости от уже неиспользуемых пакетов)
pipenv clean
```

### **Удаление виртуального окружения**

```bash
pipenv --rm
```

Удаляется директория проекта в директории с виртуальными окружениями  `/C/users/<user_name>/.virtualenvs/<my_project>`

---

## Ссылки

1. Официальный сайт [Pipenv](https://docs.pipenv.org/)
